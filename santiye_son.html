<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ûantiye Takip</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { font-size: 16px; opacity: 0.9; }
        
        .content { padding: 30px 20px; }
        
        .btn {
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:active { transform: scale(0.98); }
        
        .btn-manager {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-worker {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-back {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .card {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .card-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .card-subtitle {
            font-size: 14px;
            color: #666;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .hidden { display: none; }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
        }
        
        .tabs {
            display: flex;
            background: #f5f5f5;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }
        
        h3 { margin: 20px 0 15px; color: #333; }
        
        hr {
            margin: 30px 0;
            border: none;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è ≈ûantiye Takip</h1>
            <p>ƒ∞n≈üaat Y√∂netim Sistemi</p>
        </div>
        <div class="content" id="content">
            <!-- ƒ∞√ßerik buraya gelecek -->
        </div>
    </div>

    <script>
        // Veri yapƒ±larƒ±
        let workers = JSON.parse(localStorage.getItem('workers') || '[]');
        let sites = JSON.parse(localStorage.getItem('sites') || '[]');
        let records = JSON.parse(localStorage.getItem('records') || '[]');
        let currentWorker = JSON.parse(localStorage.getItem('currentWorker') || 'null');
        let session = JSON.parse(localStorage.getItem('session') || 'null');
        
        // Ba≈ülangƒ±√ß
        showHome();
        
        function showHome() {
            document.getElementById('content').innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <h2 style="margin-bottom: 20px; color: #333;">Ho≈ü Geldiniz</h2>
                    <p style="color: #666; margin-bottom: 40px;">Rol√ºn√ºz√º se√ßin</p>
                    <button class="btn btn-manager" onclick="showManager()">
                        üëî ƒ∞≈üveren / Y√∂netici
                    </button>
                    <button class="btn btn-worker" onclick="showWorkerLogin()">
                        üë∑ ƒ∞≈ü√ßi
                    </button>
                </div>
            `;
        }
        
        function showManager() {
            document.getElementById('content').innerHTML = `
                <button class="btn btn-back" onclick="showHome()">‚Üê Geri</button>
                <div class="tabs">
                    <button class="tab active" onclick="showManagerTab('add')">‚ûï Ekle</button>
                    <button class="tab" onclick="showManagerTab('list')">üìã Liste</button>
                    <button class="tab" onclick="showManagerTab('report')">üìä Rapor</button>
                </div>
                <div id="manager-tab"></div>
            `;
            showManagerTab('add');
        }
        
        function showManagerTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'add') {
                document.getElementById('manager-tab').innerHTML = `
                    <h3>Yeni ƒ∞≈ü√ßi Ekle</h3>
                    <div class="form-group">
                        <label>ƒ∞≈ü√ßi Adƒ± *</label>
                        <input type="text" id="wname" placeholder="Ahmet Yƒ±lmaz">
                    </div>
                    <div class="form-group">
                        <label>G√ºnl√ºk √úcret (‚Ç∫) *</label>
                        <input type="number" id="wwage" placeholder="800">
                    </div>
                    <button class="btn btn-primary" onclick="addWorker()">ƒ∞≈ü√ßi Ekle</button>
                    
                    <hr>
                    
                    <h3>Yeni ≈ûantiye Ekle</h3>
                    <div class="form-group">
                        <label>≈ûantiye Adƒ± *</label>
                        <input type="text" id="sname" placeholder="Merkez Plaza">
                    </div>
                    <div class="form-group">
                        <label>Adres *</label>
                        <input type="text" id="saddr" placeholder="ƒ∞stanbul">
                    </div>
                    <button class="btn btn-primary" onclick="addSite()">≈ûantiye Ekle</button>
                `;
            } else if (tab === 'list') {
                let html = '<h3>ƒ∞≈ü√ßiler (' + workers.length + ')</h3>';
                workers.forEach(w => {
                    html += `<div class="card">
                        <button class="delete-btn" onclick="delWorker(${w.id})">Sil</button>
                        <div class="card-title">${w.name}</div>
                        <div class="card-subtitle">üí∞ ${w.wage}‚Ç∫/g√ºn</div>
                    </div>`;
                });
                
                html += '<hr><h3>≈ûantiyeler (' + sites.length + ')</h3>';
                sites.forEach(s => {
                    html += `<div class="card">
                        <button class="delete-btn" onclick="delSite(${s.id})">Sil</button>
                        <div class="card-title">${s.name}</div>
                        <div class="card-subtitle">üìç ${s.addr}</div>
                    </div>`;
                });
                
                html += '<hr><h3>Kayƒ±tlar (' + records.length + ')</h3>';
                records.slice().reverse().forEach(r => {
                    html += `<div class="card">
                        <div class="card-title">${r.wname}</div>
                        <div class="card-subtitle">üèóÔ∏è ${r.sname} ‚Ä¢ üìÖ ${r.date}</div>
                        <div class="card-subtitle">‚è∞ ${r.hours}h ‚Ä¢ üí∞ ${r.cost}‚Ç∫</div>
                    </div>`;
                });
                
                document.getElementById('manager-tab').innerHTML = html;
            } else if (tab === 'report') {
                const totalHours = records.reduce((s, r) => s + parseFloat(r.hours), 0);
                const totalCost = records.reduce((s, r) => s + parseFloat(r.cost), 0);
                
                document.getElementById('manager-tab').innerHTML = `
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value">${totalHours.toFixed(1)}</div>
                            <div class="stat-label">Toplam Saat</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${totalCost.toFixed(0)}‚Ç∫</div>
                            <div class="stat-label">Toplam Maliyet</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${records.length}</div>
                            <div class="stat-label">Kayƒ±t</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${workers.length}</div>
                            <div class="stat-label">ƒ∞≈ü√ßi</div>
                        </div>
                    </div>
                `;
            }
        }
        
        function addWorker() {
            const name = document.getElementById('wname').value;
            const wage = document.getElementById('wwage').value;
            if (!name || !wage) { alert('L√ºtfen t√ºm alanlarƒ± doldurun'); return; }
            workers.push({ id: Date.now(), name, wage });
            localStorage.setItem('workers', JSON.stringify(workers));
            alert('‚úì ƒ∞≈ü√ßi eklendi!');
            showManager();
        }
        
        function addSite() {
            const name = document.getElementById('sname').value;
            const addr = document.getElementById('saddr').value;
            if (!name || !addr) { alert('L√ºtfen t√ºm alanlarƒ± doldurun'); return; }
            sites.push({ id: Date.now(), name, addr });
            localStorage.setItem('sites', JSON.stringify(sites));
            alert('‚úì ≈ûantiye eklendi!');
            showManager();
        }
        
        function delWorker(id) {
            if (!confirm('Silmek istediƒüinize emin misiniz?')) return;
            workers = workers.filter(w => w.id !== id);
            localStorage.setItem('workers', JSON.stringify(workers));
            showManagerTab('list');
        }
        
        function delSite(id) {
            if (!confirm('Silmek istediƒüinize emin misiniz?')) return;
            sites = sites.filter(s => s.id !== id);
            localStorage.setItem('sites', JSON.stringify(sites));
            showManagerTab('list');
        }
        
        function showWorkerLogin() {
            if (workers.length === 0) {
                alert('Hen√ºz i≈ü√ßi kaydƒ± yok. L√ºtfen y√∂netici panelinden i≈ü√ßi ekleyin.');
                showHome();
                return;
            }
            
            let html = '<button class="btn btn-back" onclick="showHome()">‚Üê Geri</button>';
            html += '<div style="text-align: center; padding: 40px 20px;">';
            html += '<h2 style="margin-bottom: 10px;">üîê Giri≈ü Yap</h2>';
            html += '<p style="color: #666; margin-bottom: 30px;">ƒ∞sminizi se√ßin</p>';
            html += '<div class="form-group"><select id="wselect" style="width: 100%; padding: 15px;">';
            html += '<option value="">ƒ∞≈ü√ßi se√ßin...</option>';
            workers.forEach(w => {
                html += `<option value="${w.id}">${w.name}</option>`;
            });
            html += '</select></div>';
            html += '<button class="btn btn-success" onclick="loginWorker()">Giri≈ü Yap</button>';
            html += '</div>';
            
            document.getElementById('content').innerHTML = html;
        }
        
        function loginWorker() {
            const id = parseInt(document.getElementById('wselect').value);
            if (!id) { alert('L√ºtfen bir i≈ü√ßi se√ßin'); return; }
            currentWorker = workers.find(w => w.id === id);
            localStorage.setItem('currentWorker', JSON.stringify(currentWorker));
            showWorkerPanel();
        }
        
        function showWorkerPanel() {
            if (!session) {
                const myRecords = records.filter(r => r.wid === currentWorker.id);
                const totalHours = myRecords.reduce((s, r) => s + parseFloat(r.hours), 0);
                const totalEarn = myRecords.reduce((s, r) => s + parseFloat(r.cost), 0);
                
                let html = '<button class="btn btn-back" onclick="logoutWorker()">üö™ √áƒ±kƒ±≈ü</button>';
                html += `<div style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; padding: 40px; border-radius: 15px; text-align: center; margin-bottom: 20px;">`;
                html += '<div style="font-size: 60px; margin-bottom: 15px;">üü¢</div>';
                html += `<h2>${currentWorker.name}</h2>`;
                html += `<p>G√ºnl√ºk: ${currentWorker.wage}‚Ç∫</p>`;
                html += '</div>';
                
                html += '<div class="form-group"><label>≈ûantiye Se√ß</label>';
                html += '<select id="wssite" style="width: 100%; padding: 15px;">';
                html += '<option value="">≈ûantiye se√ßin...</option>';
                sites.forEach(s => {
                    html += `<option value="${s.id}">${s.name}</option>`;
                });
                html += '</select></div>';
                html += '<button class="btn btn-success" onclick="startWork()">üöÄ √áalƒ±≈ümaya Ba≈üla</button>';
                
                html += `<div class="stats">
                    <div class="stat-box" style="background: #2ecc71;">
                        <div class="stat-value">${totalHours.toFixed(1)}</div>
                        <div class="stat-label">Toplam Saat</div>
                    </div>
                    <div class="stat-box" style="background: #2ecc71;">
                        <div class="stat-value">${totalEarn.toFixed(0)}‚Ç∫</div>
                        <div class="stat-label">Kazan√ß</div>
                    </div>
                </div>`;
                
                document.getElementById('content').innerHTML = html;
            } else {
                const elapsed = Math.floor((Date.now() - session.start) / 1000);
                const h = Math.floor(elapsed / 3600);
                const m = Math.floor((elapsed % 3600) / 60);
                const s = elapsed % 60;
                
                let html = '<button class="btn btn-back" onclick="logoutWorker()">üö™ √áƒ±kƒ±≈ü</button>';
                html += `<div style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 40px; border-radius: 15px; text-align: center; margin-bottom: 20px;">`;
                html += '<div style="font-size: 60px; margin-bottom: 15px;">‚ö°</div>';
                html += '<h2>√áalƒ±≈üma Devam Ediyor</h2>';
                html += `<p>${session.sname}</p>`;
                html += `<div style="font-size: 40px; font-family: monospace; margin-top: 20px;">${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}</div>`;
                html += '</div>';
                
                html += '<div class="form-group"><label>Fotoƒüraf (Zorunlu)</label>';
                html += '<input type="file" id="wphoto" accept="image/*" capture="environment" style="width: 100%; padding: 12px;"></div>';
                
                html += '<div class="form-group"><label>A√ßƒ±klama</label>';
                html += '<textarea id="wdesc" rows="3" placeholder="Bug√ºn ne yaptƒ±nƒ±z?" style="width: 100%; padding: 12px;"></textarea></div>';
                
                html += '<button class="btn btn-danger" onclick="endWork()">‚èπÔ∏è √áalƒ±≈ümayƒ± Bitir</button>';
                
                document.getElementById('content').innerHTML = html;
                
                setTimeout(() => showWorkerPanel(), 1000);
            }
        }
        
        function startWork() {
            const siteId = parseInt(document.getElementById('wssite').value);
            if (!siteId) { alert('L√ºtfen ≈üantiye se√ßin'); return; }
            
            const site = sites.find(s => s.id === siteId);
            session = {
                wid: currentWorker.id,
                wname: currentWorker.name,
                sid: siteId,
                sname: site.name,
                start: Date.now()
            };
            localStorage.setItem('session', JSON.stringify(session));
            showWorkerPanel();
        }
        
        function endWork() {
            const photo = document.getElementById('wphoto').files[0];
            if (!photo) { alert('L√ºtfen fotoƒüraf y√ºkleyin!'); return; }
            
            const hours = ((Date.now() - session.start) / (1000 * 60 * 60)).toFixed(2);
            const cost = ((parseFloat(currentWorker.wage) / 8) * parseFloat(hours)).toFixed(2);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                records.push({
                    id: Date.now(),
                    wid: session.wid,
                    wname: session.wname,
                    sname: session.sname,
                    date: new Date().toISOString().split('T')[0],
                    hours: hours,
                    cost: cost,
                    desc: document.getElementById('wdesc').value,
                    photo: e.target.result
                });
                localStorage.setItem('records', JSON.stringify(records));
                
                session = null;
                localStorage.removeItem('session');
                
                alert(`‚úì Tamamlandƒ±! ${hours} saat kaydedildi.`);
                showWorkerPanel();
            };
            reader.readAsDataURL(photo);
        }
        
        function logoutWorker() {
            if (session && !confirm('√áalƒ±≈üma devam ediyor. √áƒ±kmak istediƒüinize emin misiniz?')) return;
            currentWorker = null;
            session = null;
            localStorage.removeItem('currentWorker');
            localStorage.removeItem('session');
            showHome();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ûantiye Takip Sistemi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 95vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .header.worker { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
        .header h1 { font-size: 24px; margin-bottom: 8px; }
        .header p { font-size: 14px; opacity: 0.9; }
        
        .content { padding: 20px; min-height: 400px; }
        
        .btn {
            width: 100%;
            padding: 18px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-manager { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-worker { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-back { background: white; color: #667eea; border: 2px solid #667eea; padding: 12px; }
        
        .form-group { margin-bottom: 18px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .card {
            background: #f8f9fa;
            padding: 15px;
            margin: 12px 0;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
        
        .tabs { display: flex; background: #f5f5f5; }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .alert { padding: 15px; margin: 15px 0; border-radius: 10px; text-align: center; font-weight: 600; }
        .alert-danger { background: #f8d7da; color: #721c24; }
        
        .location-badge {
            display: inline-flex;
            padding: 8px 12px;
            background: #d4edda;
            color: #155724;
            border-radius: 8px;
            font-size: 13px;
            margin: 10px 0;
        }
        
        .status-card {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 35px 25px;
            border-radius: 16px;
            text-align: center;
            margin: 20px 0;
        }
        
        .status-card.working { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .timer { font-size: 48px; font-weight: 700; font-family: monospace; margin: 15px 0; }
        
        h3 { margin: 25px 0 15px; color: #333; }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
        let workers = JSON.parse(localStorage.getItem('workers') || '[]');
        let sites = JSON.parse(localStorage.getItem('sites') || '[]');
        let records = JSON.parse(localStorage.getItem('records') || '[]');
        let currentWorker = JSON.parse(localStorage.getItem('currentWorker') || 'null');
        let session = JSON.parse(localStorage.getItem('session') || 'null');
        let location = null;
        let timerInterval = null;
        const ADMIN_PASSWORD = '1234';
        
        init();
        
        function init() {
            startLocationTracking();
            showHome();
        }
        
        function startLocationTracking() {
            getLocation();
            setInterval(getLocation, 30000);
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => { location = { lat: pos.coords.latitude, lng: pos.coords.longitude }; },
                    err => { location = null; },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            }
        }
        
        function showHome() {
            document.getElementById('app').innerHTML = \`
                <div class="container">
                    <div class="header">
                        <h1>üèóÔ∏è ≈ûantiye Takip Sistemi</h1>
                        <p>Profesyonel ƒ∞n≈üaat Y√∂netimi</p>
                    </div>
                    <div style="padding: 60px 30px; text-align: center;">
                        <div style="font-size: 80px; margin-bottom: 25px;">üèóÔ∏è</div>
                        <h2 style="font-size: 28px; margin-bottom: 12px;">Ho≈ü Geldiniz</h2>
                        <p style="color: #666; margin-bottom: 40px;">Devam etmek i√ßin rol√ºn√ºz√º se√ßin</p>
                        <button class="btn btn-manager" onclick="showManagerLogin()">üëî ƒ∞≈üveren / Y√∂netici</button>
                        <button class="btn btn-worker" onclick="showWorkerLogin()">üë∑ ƒ∞≈ü√ßi</button>
                    </div>
                </div>
            \`;
        }
        
        function showManagerLogin() {
            document.getElementById('app').innerHTML = \`
                <div class="container">
                    <div class="header"><h1>üëî Y√∂netici Giri≈üi</h1></div>
                    <div class="content">
                        <button class="btn btn-back" onclick="showHome()">‚Üê Geri</button>
                        <div style="padding: 40px 20px; text-align: center;">
                            <div style="font-size: 60px; margin-bottom: 20px;">üîê</div>
                            <h2 style="margin-bottom: 30px;">≈ûifre Girin</h2>
                            <div class="form-group">
                                <input type="password" id="adminPass" placeholder="≈ûifre" onkeypress="if(event.key==='Enter') checkManagerPassword()">
                            </div>
                            <button class="btn btn-primary" onclick="checkManagerPassword()">Giri≈ü</button>
                            <div style="margin-top: 20px; font-size: 12px; color: #999;">Varsayƒ±lan: 1234</div>
                        </div>
                    </div>
                </div>
            \`;
            setTimeout(() => document.getElementById('adminPass').focus(), 100);
        }
        
        function checkManagerPassword() {
            if (document.getElementById('adminPass').value === ADMIN_PASSWORD) {
                showManagerPanel();
            } else {
                alert('‚ùå Hatalƒ± ≈üifre!');
            }
        }
        
        function showManagerPanel(tab = 'add') {
            document.getElementById('app').innerHTML = \`
                <div class="container">
                    <div class="header"><h1>üëî Y√∂netici Paneli</h1></div>
                    <div class="tabs">
                        <button class="tab \${tab === 'add' ? 'active' : ''}" onclick="showManagerPanel('add')">‚ûï Ekle</button>
                        <button class="tab \${tab === 'list' ? 'active' : ''}" onclick="showManagerPanel('list')">üìã Liste</button>
                        <button class="tab \${tab === 'report' ? 'active' : ''}" onclick="showManagerPanel('report')">üìä Rapor</button>
                    </div>
                    <div class="content">
                        <button class="btn btn-back" onclick="showHome()">‚Üê √áƒ±kƒ±≈ü</button>
                        <div id="manager-content"></div>
                    </div>
                </div>
            \`;
            
            if (tab === 'add') {
                document.getElementById('manager-content').innerHTML = \`
                    <h3>ƒ∞≈ü√ßi Ekle</h3>
                    <div class="form-group"><label>Ad Soyad *</label><input id="wname" placeholder="Ahmet Yƒ±lmaz"></div>
                    <div class="form-group"><label>G√ºnl√ºk √úcret *</label><input type="number" id="wwage" placeholder="800"></div>
                    <button class="btn btn-primary" onclick="addWorker()">Ekle</button>
                    <hr style="margin: 30px 0; border: 1px solid #f0f0f0;">
                    <h3>≈ûantiye Ekle</h3>
                    <div class="form-group"><label>≈ûantiye Adƒ± *</label><input id="sname" placeholder="Merkez Plaza"></div>
                    <div class="form-group"><label>Adres *</label><input id="saddr" placeholder="ƒ∞stanbul"></div>
                    <button class="btn btn-primary" onclick="addSite()">Ekle</button>
                \`;
            } else if (tab === 'list') {
                let html = '<h3>ƒ∞≈ü√ßiler (' + workers.length + ')</h3>';
                workers.forEach(w => {
                    html += '<div class="card"><b>' + w.name + '</b><br><small>üí∞ ' + w.wage + '‚Ç∫/g√ºn</small></div>';
                });
                html += '<hr style="margin: 30px 0;"><h3>≈ûantiyeler (' + sites.length + ')</h3>';
                sites.forEach(s => {
                    html += '<div class="card"><b>' + s.name + '</b><br><small>üìç ' + s.addr + '</small></div>';
                });
                html += '<hr style="margin: 30px 0;"><h3>Kayƒ±tlar (' + records.length + ')</h3>';
                records.slice().reverse().forEach(r => {
                    html += '<div class="card"><b>' + r.wname + ' - ' + r.cost + '‚Ç∫</b><br><small>üèóÔ∏è ' + r.sname + ' ‚Ä¢ ' + r.hours + ' saat</small></div>';
                });
                document.getElementById('manager-content').innerHTML = html;
            } else if (tab === 'report') {
                const totalCost = records.reduce((s, r) => s + parseFloat(r.cost), 0);
                const totalHours = records.reduce((s, r) => s + parseFloat(r.hours), 0);
                document.getElementById('manager-content').innerHTML = \`
                    <div class="stats">
                        <div class="stat-box"><div class="stat-value">\${totalHours.toFixed(1)}</div><div>Saat</div></div>
                        <div class="stat-box"><div class="stat-value">\${totalCost.toFixed(0)}‚Ç∫</div><div>Maliyet</div></div>
                    </div>
                \`;
            }
        }
        
        function addWorker() {
            const name = document.getElementById('wname').value.trim();
            const wage = document.getElementById('wwage').value.trim();
            if (!name || !wage) { alert('Eksik bilgi!'); return; }
            workers.push({ id: Date.now(), name, wage });
            localStorage.setItem('workers', JSON.stringify(workers));
            alert('‚úÖ Eklendi!');
            showManagerPanel('add');
        }
        
        function addSite() {
            const name = document.getElementById('sname').value.trim();
            const addr = document.getElementById('saddr').value.trim();
            if (!name || !addr) { alert('Eksik bilgi!'); return; }
            sites.push({ id: Date.now(), name, addr });
            localStorage.setItem('sites', JSON.stringify(sites));
            alert('‚úÖ Eklendi!');
            showManagerPanel('add');
        }
        
        function showWorkerLogin() {
            if (workers.length === 0) { alert('Hen√ºz i≈ü√ßi yok!'); showHome(); return; }
            document.getElementById('app').innerHTML = \`
                <div class="container">
                    <div class="header worker"><h1>üë∑ ƒ∞≈ü√ßi Giri≈üi</h1></div>
                    <div class="content">
                        <button class="btn btn-back" onclick="showHome()">‚Üê Geri</button>
                        <div style="padding: 40px 20px; text-align: center;">
                            <div style="font-size: 60px; margin-bottom: 20px;">üë∑</div>
                            <h2 style="margin-bottom: 30px;">ƒ∞sim Se√ß</h2>
                            <div class="form-group">
                                <select id="wselect">
                                    <option value="">Se√ßin...</option>
                                    \${workers.map(w => '<option value="' + w.id + '">' + w.name + '</option>').join('')}
                                </select>
                            </div>
                            <button class="btn btn-success" onclick="loginWorker()">Giri≈ü</button>
                        </div>
                    </div>
                </div>
            \`;
        }
        
        function loginWorker() {
            const id = parseInt(document.getElementById('wselect').value);
            if (!id) { alert('ƒ∞≈ü√ßi se√ßin!'); return; }
            currentWorker = workers.find(w => w.id === id);
            localStorage.setItem('currentWorker', JSON.stringify(currentWorker));
            showWorkerPanel();
        }
        
        function showWorkerPanel() {
            const myRecords = records.filter(r => r.wid === currentWorker.id);
            const totalHours = myRecords.reduce((s, r) => s + parseFloat(r.hours), 0);
            
            if (!session) {
                let html = \`
                    <div class="container">
                        <div class="header worker"><h1>üë∑ \${currentWorker.name}</h1></div>
                        <div class="content">
                            <button class="btn btn-back" onclick="logoutWorker()">üö™ √áƒ±kƒ±≈ü</button>
                \`;
                
                if (!location) {
                    html += '<div class="alert alert-danger">‚ö†Ô∏è GPS KAPALI! A√ßƒ±n ve yenileyin.</div>';
                } else {
                    html += '<div class="location-badge">‚úì GPS Aktif</div>';
                }
                
                html += \`
                    <div class="status-card"><div style="font-size: 60px;">üü¢</div><h2>Hazƒ±r</h2></div>
                    <div class="form-group">
                        <label>≈ûantiye</label>
                        <select id="wssite">
                            <option value="">Se√ßin...</option>
                            \${sites.map(s => '<option value="' + s.id + '">' + s.name + '</option>').join('')}
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="startWork()" \${!location ? 'disabled' : ''}>üöÄ Ba≈üla</button>
                    <div class="stats">
                        <div class="stat-box" style="background: #2ecc71;"><div class="stat-value">\${totalHours.toFixed(1)}</div><div>Saat</div></div>
                        <div class="stat-box" style="background: #2ecc71;"><div class="stat-value">\${myRecords.length}</div><div>G√ºn</div></div>
                    </div>
                </div></div>
                \`;
                document.getElementById('app').innerHTML = html;
            } else {
                const elapsed = Math.floor((Date.now() - session.start) / 1000);
                const h = Math.floor(elapsed / 3600);
                const m = Math.floor((elapsed % 3600) / 60);
                const s = elapsed % 60;
                
                let html = \`
                    <div class="container">
                        <div class="header worker"><h1>üë∑ \${currentWorker.name}</h1></div>
                        <div class="content">
                            <button class="btn btn-back" onclick="confirmLogout()">üö™ √áƒ±kƒ±≈ü</button>
                            <div class="status-card working">
                                <div style="font-size: 60px;">‚ö°</div>
                                <h2>\${session.sname}</h2>
                                <div class="timer" id="timer">\${h.toString().padStart(2,'0')}:\${m.toString().padStart(2,'0')}:\${s.toString().padStart(2,'0')}</div>
                            </div>
                            <div class="form-group">
                                <label>Fotoƒüraf (Zorunlu)</label>
                                <input type="file" id="wphoto" accept="image/*" capture="environment" style="width:100%;padding:12px;">
                            </div>
                            <button class="btn btn-danger" onclick="endWork()">‚èπÔ∏è Bitir</button>
                        </div>
                    </div>
                \`;
                document.getElementById('app').innerHTML = html;
                
                if (timerInterval) clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - session.start) / 1000);
                    const h = Math.floor(elapsed / 3600);
                    const m = Math.floor((elapsed % 3600) / 60);
                    const s = elapsed % 60;
                    const timer = document.getElementById('timer');
                    if (timer) timer.textContent = h.toString().padStart(2,'0') + ':' + m.toString().padStart(2,'0') + ':' + s.toString().padStart(2,'0');
                }, 1000);
            }
        }
        
        function startWork() {
            if (!location) { alert('GPS yok!'); return; }
            const siteId = parseInt(document.getElementById('wssite').value);
            if (!siteId) { alert('≈ûantiye se√ßin!'); return; }
            const site = sites.find(s => s.id === siteId);
            session = { wid: currentWorker.id, wname: currentWorker.name, sid: siteId, sname: site.name, start: Date.now() };
            localStorage.setItem('session', JSON.stringify(session));
            showWorkerPanel();
        }
        
        function endWork() {
            if (!location) { alert('GPS yok!'); return; }
            const photo = document.getElementById('wphoto').files[0];
            if (!photo) { alert('Fotoƒüraf gerekli!'); return; }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const hours = ((Date.now() - session.start) / (1000 * 60 * 60)).toFixed(2);
                const cost = ((parseFloat(currentWorker.wage) / 8) * parseFloat(hours)).toFixed(2);
                records.push({
                    id: Date.now(),
                    wid: session.wid,
                    wname: session.wname,
                    sid: session.sid,
                    sname: session.sname,
                    date: new Date().toISOString().split('T')[0],
                    hours: hours,
                    cost: cost,
                    photo: e.target.result
                });
                localStorage.setItem('records', JSON.stringify(records));
                session = null;
                localStorage.removeItem('session');
                if (timerInterval) clearInterval(timerInterval);
                alert('‚úÖ ' + hours + ' saat kaydedildi!');
                showWorkerPanel();
            };
            reader.readAsDataURL(photo);
        }
        
        function confirmLogout() {
            if (session && !confirm('√áalƒ±≈üma devam ediyor! √áƒ±kmak istediƒüinize emin misiniz?')) return;
            logoutWorker();
        }
        
        function logoutWorker() {
            currentWorker = null;
            session = null;
            localStorage.removeItem('currentWorker');
            localStorage.removeItem('session');
            if (timerInterval) clearInterval(timerInterval);
            showHome();
        }
    </script>
</body>
</html>

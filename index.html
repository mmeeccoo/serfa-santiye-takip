<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERFA TEKNÄ°K - Åantiye Takip</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 95vh;
        }
        .brand {
            background: #1a1a2e;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            letter-spacing: 2px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        .header.worker { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); }
        .header h1 { font-size: 22px; margin-bottom: 5px; }
        .header p { font-size: 13px; opacity: 0.9; }
        .content { padding: 20px; min-height: 400px; }
        .btn {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-manager { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-worker { background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-excel { background: #217346; color: white; }
        .btn-back { background: white; color: #667eea; border: 2px solid #667eea; padding: 12px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .card { background: #f8f9fa; padding: 14px; margin: 10px 0; border-radius: 10px; border-left: 4px solid #667eea; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0; }
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value { font-size: 28px; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 12px; opacity: 0.9; }
        .tabs { display: flex; background: #f5f5f5; }
        .tab {
            flex: 1;
            padding: 14px;
            text-align: center;
            background: none;
            border: none;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
        }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .alert { padding: 12px; margin: 12px 0; border-radius: 8px; text-align: center; font-weight: 600; font-size: 13px; }
        .alert-danger { background: #f8d7da; color: #721c24; }
        .alert-success { background: #d4edda; color: #155724; }
        .location-badge {
            display: inline-flex;
            padding: 6px 12px;
            background: #d4edda;
            color: #155724;
            border-radius: 6px;
            font-size: 12px;
            margin: 8px 0;
        }
        .photo-preview { margin-top: 12px; border-radius: 10px; overflow: hidden; max-width: 100%; }
        .photo-preview img { width: 100%; height: auto; display: block; }
        h3 { margin: 20px 0 12px; color: #333; font-size: 17px; }
        .home-icon { font-size: 70px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
        var workers = JSON.parse(localStorage.getItem('workers') || '[]');
        var sites = JSON.parse(localStorage.getItem('sites') || '[]');
        var records = JSON.parse(localStorage.getItem('records') || '[]');
        var currentWorker = JSON.parse(localStorage.getItem('currentWorker') || 'null');
        var workStart = JSON.parse(localStorage.getItem('workStart') || 'null');
        var location = null;
        var ADMIN_PASSWORD = '1234';
        
        init();
        
        function init() {
            getLocation();
            setInterval(getLocation, 30000);
            showHome();
        }
        
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(pos) { location = { lat: pos.coords.latitude, lng: pos.coords.longitude }; },
                    function(err) { location = null; }
                );
            }
        }
        
        function showHome() {
            var html = '<div class="container">';
            html += '<div class="brand">SERFA TEKNÄ°K</div>';
            html += '<div class="header"><h1>ğŸ—ï¸ Åantiye Takip Sistemi</h1><p>Profesyonel Ä°nÅŸaat YÃ¶netimi</p></div>';
            html += '<div style="padding: 50px 30px; text-align: center;">';
            html += '<div class="home-icon">ğŸ—ï¸</div>';
            html += '<h2 style="margin-bottom: 30px;">HoÅŸ Geldiniz</h2>';
            html += '<button class="btn btn-manager" onclick="showManagerLogin()">ğŸ‘” Ä°ÅŸveren / YÃ¶netici</button>';
            html += '<button class="btn btn-worker" onclick="showWorkerLogin()">ğŸ‘· Ä°ÅŸÃ§i</button>';
            html += '</div></div>';
            document.getElementById('app').innerHTML = html;
        }
        
        function showManagerLogin() {
            var html = '<div class="container">';
            html += '<div class="brand">SERFA TEKNÄ°K</div>';
            html += '<div class="header"><h1>ğŸ‘” YÃ¶netici GiriÅŸi</h1></div>';
            html += '<div class="content">';
            html += '<button class="btn btn-back" onclick="showHome()">â† Geri</button>';
            html += '<div style="padding: 30px 20px; text-align: center;">';
            html += '<div style="font-size: 50px; margin-bottom: 15px;">ğŸ”</div>';
            html += '<h2 style="margin-bottom: 20px;">Åifre Girin</h2>';
            html += '<div class="form-group"><input type="password" id="adminPass" placeholder="Åifre (varsayÄ±lan: 1234)"></div>';
            html += '<button class="btn btn-primary" onclick="checkPassword()">GiriÅŸ Yap</button>';
            html += '</div></div></div>';
            document.getElementById('app').innerHTML = html;
        }
        
        function checkPassword() {
            if (document.getElementById('adminPass').value === ADMIN_PASSWORD) {
                showManagerPanel('add');
            } else {
                alert('âŒ HatalÄ± ÅŸifre!');
            }
        }
        
        function showManagerPanel(tab) {
            var html = '<div class="container">';
            html += '<div class="brand">SERFA TEKNÄ°K</div>';
            html += '<div class="header"><h1>ğŸ‘” YÃ¶netici Paneli</h1></div>';
            html += '<div class="tabs">';
            html += '<button class="tab ' + (tab === 'add' ? 'active' : '') + '" onclick="showManagerPanel(\'add\')">â• Ekle</button>';
            html += '<button class="tab ' + (tab === 'list' ? 'active' : '') + '" onclick="showManagerPanel(\'list\')">ğŸ“‹ Liste</button>';
            html += '<button class="tab ' + (tab === 'report' ? 'active' : '') + '" onclick="showManagerPanel(\'report\')">ğŸ“Š Rapor</button>';
            html += '</div><div class="content">';
            html += '<button class="btn btn-back" onclick="showHome()">â† Ã‡Ä±kÄ±ÅŸ</button>';
            
            if (tab === 'add') {
                html += '<h3>â• Ä°ÅŸÃ§i Ekle</h3>';
                html += '<div class="form-group"><label>Ad Soyad *</label><input id="wname" placeholder="Ahmet YÄ±lmaz"></div>';
                html += '<div class="form-group"><label>GÃ¼nlÃ¼k Ãœcret (â‚º) *</label><input type="number" id="wwage" placeholder="800"></div>';
                html += '<button class="btn btn-primary" onclick="addWorker()">Ä°ÅŸÃ§i Ekle</button>';
                html += '<hr style="margin: 25px 0; border: 1px solid #f0f0f0;">';
                html += '<h3>ğŸ—ï¸ Åantiye Ekle</h3>';
                html += '<div class="form-group"><label>Åantiye AdÄ± *</label><input id="sname" placeholder="Merkez Plaza"></div>';
                html += '<div class="form-group"><label>Adres *</label><input id="saddr" placeholder="Ä°stanbul, KadÄ±kÃ¶y"></div>';
                html += '<button class="btn btn-primary" onclick="addSite()">Åantiye Ekle</button>';
            } else if (tab === 'list') {
                html += '<h3>ğŸ‘· Ä°ÅŸÃ§iler (' + workers.length + ')</h3>';
                if (workers.length === 0) {
                    html += '<div style="text-align: center; padding: 30px; color: #999;">HenÃ¼z iÅŸÃ§i eklenmemiÅŸ</div>';
                } else {
                    for (var i = 0; i < workers.length; i++) {
                        html += '<div class="card"><b>' + workers[i].name + '</b><br><small style="color: #666;">ğŸ’° ' + workers[i].wage + 'â‚º/gÃ¼n</small></div>';
                    }
                }
                html += '<h3>ğŸ—ï¸ Åantiyeler (' + sites.length + ')</h3>';
                if (sites.length === 0) {
                    html += '<div style="text-align: center; padding: 30px; color: #999;">HenÃ¼z ÅŸantiye eklenmemiÅŸ</div>';
                } else {
                    for (var i = 0; i < sites.length; i++) {
                        html += '<div class="card"><b>' + sites[i].name + '</b><br><small style="color: #666;">ğŸ“ ' + sites[i].addr + '</small></div>';
                    }
                }
                html += '<h3>ğŸ“ Ã‡alÄ±ÅŸma KayÄ±tlarÄ± (' + records.length + ')</h3>';
                if (records.length === 0) {
                    html += '<div style="text-align: center; padding: 30px; color: #999;">HenÃ¼z kayÄ±t oluÅŸturulmamÄ±ÅŸ</div>';
                } else {
                    for (var i = records.length - 1; i >= 0; i--) {
                        var r = records[i];
                        html += '<div class="card"><b>' + r.wname + ' - ' + r.cost + 'â‚º</b><br>';
                        html += '<small style="color: #666;">ğŸ—ï¸ ' + r.sname + ' â€¢ ğŸ“… ' + r.date + ' â€¢ â° ' + r.hours + ' saat</small>';
                        if (r.photo) {
                            html += '<div class="photo-preview"><img src="' + r.photo + '" alt="Ã‡alÄ±ÅŸma"></div>';
                        }
                        html += '</div>';
                    }
                }
            } else if (tab === 'report') {
                var totalCost = 0;
                var totalHours = 0;
                for (var i = 0; i < records.length; i++) {
                    totalCost += parseFloat(records[i].cost);
                    totalHours += parseFloat(records[i].hours);
                }
                html += '<button class="btn btn-excel" onclick="exportToExcel()">ğŸ“Š Excel\'e DÃ¶kÃ¼mle</button>';
                html += '<div class="stats">';
                html += '<div class="stat-box"><div class="stat-value">' + totalHours.toFixed(1) + '</div><div class="stat-label">TOPLAM SAAT</div></div>';
                html += '<div class="stat-box"><div class="stat-value">' + totalCost.toFixed(0) + 'â‚º</div><div class="stat-label">TOPLAM MALÄ°YET</div></div>';
                html += '<div class="stat-box"><div class="stat-value">' + records.length + '</div><div class="stat-label">KAYIT SAYISI</div></div>';
                html += '<div class="stat-box"><div class="stat-value">' + workers.length + '</div><div class="stat-label">AKTÄ°F Ä°ÅÃ‡Ä°</div></div>';
                html += '</div>';
                
                html += '<h3>ğŸ‘· Ä°ÅŸÃ§i BazlÄ± Rapor</h3>';
                var workerStats = {};
                for (var i = 0; i < records.length; i++) {
                    var wid = records[i].wid;
                    if (!workerStats[wid]) {
                        workerStats[wid] = { name: records[i].wname, hours: 0, cost: 0, days: 0 };
                    }
                    workerStats[wid].hours += parseFloat(records[i].hours);
                    workerStats[wid].cost += parseFloat(records[i].cost);
                    workerStats[wid].days++;
                }
                for (var wid in workerStats) {
                    var ws = workerStats[wid];
                    html += '<div class="card"><b>' + ws.name + '</b><br>';
                    html += '<small style="color: #666;">â° ' + ws.hours.toFixed(1) + ' saat â€¢ ğŸ“… ' + ws.days + ' gÃ¼n â€¢ ğŸ’° ' + ws.cost.toFixed(0) + 'â‚º</small></div>';
                }
            }
            
            html += '</div></div>';
            document.getElementById('app').innerHTML = html;
        }
        
        function addWorker() {
            var name = document.getElementById('wname').value.trim();
            var wage = document.getElementById('wwage').value.trim();
            if (!name || !wage) { alert('âŒ LÃ¼tfen tÃ¼m alanlarÄ± doldurun!'); return; }
            workers.push({ id: Date.now(), name: name, wage: wage });
            localStorage.setItem('workers', JSON.stringify(workers));
            alert('âœ… Ä°ÅŸÃ§i eklendi!');
            showManagerPanel('add');
        }
        
        function addSite() {
            var name = document.getElementById('sname').value.trim();
            var addr = document.getElementById('saddr').value.trim();
            if (!name || !addr) { alert('âŒ LÃ¼tfen tÃ¼m alanlarÄ± doldurun!'); return; }
            sites.push({ id: Date.now(), name: name, addr: addr });
            localStorage.setItem('sites', JSON.stringify(sites));
            alert('âœ… Åantiye eklendi!');
            showManagerPanel('add');
        }
        
        function exportToExcel() {
            var csv = 'Ä°ÅŸÃ§i AdÄ±,Åantiye,Tarih,Saat,Maliyet (â‚º)\n';
            for (var i = 0; i < records.length; i++) {
                var r = records[i];
                csv += r.wname + ',' + r.sname + ',' + r.date + ',' + r.hours + ',' + r.cost + '\n';
            }
            var blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'serfa-santiye-rapor-' + new Date().toISOString().split('T')[0] + '.csv';
            link.click();
            alert('âœ… Excel dosyasÄ± indirildi!');
        }
        
        function showWorkerLogin() {
            if (workers.length === 0) { alert('âš ï¸ HenÃ¼z iÅŸÃ§i kaydÄ± yok. LÃ¼tfen yÃ¶netici ile iletiÅŸime geÃ§in.'); showHome(); return; }
            var html = '<div class="container">';
            html += '<div class="brand">SERFA TEKNÄ°K</div>';
            html += '<div class="header worker"><h1>ğŸ‘· Ä°ÅŸÃ§i GiriÅŸi</h1></div>';
            html += '<div class="content">';
            html += '<button class="btn btn-back" onclick="showHome()">â† Geri</button>';
            html += '<div style="padding: 30px 20px; text-align: center;">';
            html += '<div style="font-size: 50px; margin-bottom: 15px;">ğŸ‘·</div>';
            html += '<h2 style="margin-bottom: 20px;">Ä°sminizi SeÃ§in</h2>';
            html += '<div class="form-group"><select id="wselect"><option value="">SeÃ§in...</option>';
            for (var i = 0; i < workers.length; i++) {
                html += '<option value="' + workers[i].id + '">' + workers[i].name + '</option>';
            }
            html += '</select></div>';
            html += '<button class="btn btn-success" onclick="loginWorker()">GiriÅŸ Yap</button>';
            html += '</div></div></div>';
            document.getElementById('app').innerHTML = html;
        }
        
        function loginWorker() {
            var id = parseInt(document.getElementById('wselect').value);
            if (!id) { alert('âŒ LÃ¼tfen bir iÅŸÃ§i seÃ§in!'); return; }
            for (var i = 0; i < workers.length; i++) {
                if (workers[i].id === id) {
                    currentWorker = workers[i];
                    break;
                }
            }
            localStorage.setItem('currentWorker', JSON.stringify(currentWorker));
            showWorkerPanel();
        }
        
        function showWorkerPanel() {
            var myRecords = [];
            for (var i = 0; i < records.length; i++) {
                if (records[i].wid === currentWorker.id) {
                    myRecords.push(records[i]);
                }
            }
            
            var html = '<div class="container">';
            html += '<div class="brand">SERFA TEKNÄ°K</div>';
            html += '<div class="header worker"><h1>ğŸ‘· ' + currentWorker.name + '</h1><p>Ä°ÅŸÃ§i Paneli</p></div>';
            html += '<div class="content">';
            html += '<button class="btn btn-back" onclick="logoutWorker()">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>';
            
            if (!workStart) {
                if (!location) {
                    html += '<div class="alert alert-danger">âš ï¸ GPS KAPALI! Ã‡alÄ±ÅŸmaya baÅŸlamak iÃ§in GPS\'i aÃ§Ä±n ve sayfayÄ± yenileyin.</div>';
                } else {
                    html += '<div class="location-badge">âœ… GPS Aktif</div>';
                }
                html += '<div style="background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; padding: 30px; border-radius: 12px; text-align: center; margin: 15px 0;">';
                html += '<div style="font-size: 50px; margin-bottom: 10px;">ğŸŸ¢</div>';
                html += '<h2 style="margin-bottom: 5px;">HazÄ±r</h2>';
                html += '<p style="font-size: 13px; opacity: 0.9;">Ã‡alÄ±ÅŸmaya baÅŸlamak iÃ§in ÅŸantiye seÃ§in</p>';
                html += '</div>';
                html += '<div class="form-group"><label>Åantiye SeÃ§ *</label><select id="wssite"><option value="">SeÃ§in...</option>';
                for (var i = 0; i < sites.length; i++) {
                    html += '<option value="' + sites[i].id + '">' + sites[i].name + '</option>';
                }
                html += '</select></div>';
                html += '<button class="btn btn-success" onclick="startWork()" ' + (!location ? 'disabled' : '') + '>ğŸš€ Ã‡alÄ±ÅŸmaya BaÅŸla</button>';
                
                html += '<h3>ğŸ“‹ YÃ¼klediÄŸim KayÄ±tlar (' + myRecords.length + ')</h3>';
                if (myRecords.length === 0) {
                    html += '<div style="text-align: center; padding: 30px; color: #999;">HenÃ¼z kayÄ±t yok</div>';
                } else {
                    for (var i = myRecords.length - 1; i >= 0; i--) {
                        var r = myRecords[i];
                        html += '<div class="card"><b>ğŸ—ï¸ ' + r.sname + '</b><br>';
                        html += '<small style="color: #666;">ğŸ“… ' + r.date + ' â€¢ â° ' + r.hours + ' saat</small>';
                        if (r.photo) {
                            html += '<div class="photo-preview"><img src="' + r.photo + '" alt="Ã‡alÄ±ÅŸma"></div>';
                        }
                        html += '</div>';
                    }
                }
            } else {
                html += '<div class="alert alert-success">âš¡ Ã‡alÄ±ÅŸma devam ediyor...</div>';
                html += '<div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 30px; border-radius: 12px; text-align: center; margin: 15px 0;">';
                html += '<div style="font-size: 50px; margin-bottom: 10px;">âš¡</div>';
                html += '<h2>' + workStart.sname + '</h2>';
                html += '<p style="font-size: 13px; opacity: 0.9; margin-top: 5px;">BaÅŸlangÄ±Ã§: ' + new Date(workStart.time).toLocaleTimeString('tr-TR') + '</p>';
                html += '</div>';
                html += '<div class="form-group"><label>ğŸ“¸ Ã‡alÄ±ÅŸma FotoÄŸrafÄ± (Zorunlu)</label>';
                html += '<input type="file" id="wphoto" accept="image/*" capture="environment" style="width:100%;padding:12px;border:2px dashed #2ecc71;border-radius:8px;"></div>';
                html += '<button class="btn btn-danger" onclick="endWork()">â¹ï¸ Ã‡alÄ±ÅŸmayÄ± Bitir ve Kaydet</button>';
            }
            
            html += '</div></div>';
            document.getElementById('app').innerHTML = html;
        }
        
        function startWork() {
            if (!location) { alert('âŒ GPS kapalÄ±! LÃ¼tfen GPS\'i aÃ§Ä±n.'); return; }
            var siteId = parseInt(document.getElementById('wssite').value);
            if (!siteId) { alert('âŒ LÃ¼tfen ÅŸantiye seÃ§in!'); return; }
            var site = null;
            for (var i = 0; i < sites.length; i++) {
                if (sites[i].id === siteId) {
                    site = sites[i];
                    break;
                }
            }
            workStart = { wid: currentWorker.id, wname: currentWorker.name, sid: siteId, sname: site.name, time: Date.now() };
            localStorage.setItem('workStart', JSON.stringify(workStart));
            alert('âœ… Ã‡alÄ±ÅŸma baÅŸladÄ±!');
            showWorkerPanel();
        }
        
        function endWork() {
            if (!location) { alert('âš ï¸ GPS sinyali yok! LÃ¼tfen GPS\'i aÃ§Ä±n.'); return; }
            var photo = document.getElementById('wphoto').files[0];
            if (!photo) { alert('âŒ LÃ¼tfen Ã§alÄ±ÅŸma fotoÄŸrafÄ± yÃ¼kleyin!'); return; }
            
            var reader = new FileReader();
            reader.onload = function(e) {
                var hours = ((Date.now() - workStart.time) / (1000 * 60 * 60)).toFixed(2);
                var cost = ((parseFloat(currentWorker.wage) / 8) * parseFloat(hours)).toFixed(2);
                records.push({
                    id: Date.now(),
                    wid: workStart.wid,
                    wname: workStart.wname,
                    sid: workStart.sid,
                    sname: workStart.sname,
                    date: new Date().toISOString().split('T')[0],
                    hours: hours,
                    cost: cost,
                    photo: e.target.result
                });
                localStorage.setItem('records', JSON.stringify(records));
                workStart = null;
                localStorage.removeItem('workStart');
                alert('âœ… TamamlandÄ±! ' + hours + ' saat kaydedildi.');
                showWorkerPanel();
            };
            reader.readAsDataURL(photo);
        }
        
        function logoutWorker() {
            if (workStart && !confirm('âš ï¸ Ã‡alÄ±ÅŸma devam ediyor! Ã‡Ä±karsanÄ±z kayÄ±t silinecek. Emin misiniz?')) return;
            currentWorker = null;
            workStart = null;
            localStorage.removeItem('currentWorker');
            localStorage.removeItem('workStart');
            showHome();
        }
    </script>
</body>
</html>
